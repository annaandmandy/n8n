# AI 股價分析系統 規格說明書

> **用途說明**: 本規格說明書作為AI提示語使用，將此完整內容提交給AI，AI將根據規格生成完整的應用程式碼。

## 📋 系統概述

### 系統名稱
【Code Gym】AI 股票趨勢分析系統

### 核心功能描述
建立一個基於網頁的股票技術分析工具，能夠：
1. 獲取指定股票的歷史價格數據和技術指標
2. 繪製專業的K線圖和移動平均線圖表 
3. 使用AI進行深度技術面分析和趨勢解讀
4. 提供客觀的歷史數據分析和教育性技術指標說明

### 技術架構要求
- **界面框架**: 使用 Streamlit 框架
- **數據來源**: FinMind API for 台股
- **AI 模型**: OpenAI
- **AI 模型版本**: o4-mini
- **視覺化工具**: 互動式圖表 (使用 Plotly Graph Objects)
- **數據處理**: Pandas, NumPy
- **HTTP請求**: requests
- **日期處理**: datetime
- **部署方式**: 可直接在瀏覽器中運行

## 🎯 功能需求規格

### F-001: 用戶界面設計
**基本要求**: 
- 頁面標題: "AI 股票趨勢分析系統"，使用彩虹色分隔線 (divider="rainbow")
- 左側控制區包含：
  - 系統Logo "分析設定" (divider="rainbow")
  - 股票代碼輸入：用戶輸入美股股票代碼進行分析 (預設值: "AAPL")
  - FMP API Key：用戶輸入Financial Modeling Prep API金鑰 (type="password")
  - OpenAI API Key：用戶輸入OpenAI API金鑰 (type="password")
  - 起始日期選擇：用戶選擇分析起始日期（預設為90天前）
  - 結束日期選擇：用戶選擇分析結束日期（預設為今天）
- 主要執行按鈕: "分析"

### F-002: 數據獲取功能
**功能目標**: 自動從Finmind API獲取股票歷史價格數據
**用戶操作**: 用戶輸入股票代碼和日期範圍後，系統自動取得相關數據
**數據來源與說明**:
- FinMind API: 獲取股票歷史價格數據，包含開盤、最高、最低、收盤價和成交量
- API網址範例: `https://api.finmindtrade.com/api/v4/data?`

**數據範圍**: 
- 價格數據: 包含開盤價(open)、最高價(high)、最低價(low)、收盤價(close)
- 成交量數據: 每日交易量(volume)
- 時間範圍: 根據用戶選擇的起始和結束日期
**處理要求**: 
- 自動檢查API響應的有效性
- 提供友善的錯誤提示當API調用失敗時
- 驗證股票代碼格式的正確性

### F-003: 數據處理與計算
**處理目標**: 將原始價格數據轉換為技術分析用的指標數據
**計算項目**:
- MA5: 5日移動平均線，計算最近5個交易日收盤價的平均值
- MA10: 10日移動平均線，計算最近10個交易日收盤價的平均值
- MA20: 20日移動平均線，計算最近20個交易日收盤價的平均值
- MA60: 60日移動平均線，計算最近60個交易日收盤價的平均值
**通用品質要求**: 
- 計算結果準確可靠，符合技術分析專業標準
- 妥善處理資料缺失和異常值情況，使用Pandas的rolling函數
- 確保歷史資料時間序列的一致性，按日期升序排列
- 實施適當的數據驗證機制，檢查數據完整性
- 保持數據處理的可追溯性，顯示數據處理步驟

### F-004: 主要顯示區域設計
**單一區域設計**: 主要內容區域包含以下要素
1. "股價K線圖與技術指標": 顯示互動式K線圖表和移動平均線
2. "基本統計資訊": 顯示期間價格變化的關鍵數據
3. "AI技術分析": 顯示AI生成的專業技術分析報告
4. "歷史數據表格": 顯示最近10筆交易日的詳細數據

#### 股價K線圖與技術指標詳細內容：
- 主要指標: K線圖(開高低收)、MA5、MA10、MA20、MA60移動平均線
- 主要圖表: 使用Plotly Graph Objects繪製Candlestick K線圖
- 顯示數據: 收盤價、移動平均線、成交量
- 互動功能: 縮放、平移、懸停顯示詳細價格資訊
- 視覺提示: 不同顏色的移動平均線，清晰的K線顏色區分
- 圖表標題: 顯示股票代碼和分析期間
- 軸標籤: X軸為日期，Y軸為價格
- 圖例設置: 水平排列在圖表上方，包含K線圖和各條移動平均線

### F-005: 基本資訊展示
**展示方式**: 使用 st.columns(3) 展示重要的價格統計資訊
**展示內容**:
- 第一欄: 起始價格 - 分析期間第一個交易日的收盤價
- 第二欄: 結束價格 - 分析期間最後一個交易日的收盤價 
- 第三欄: 價格變化 - 顯示期間漲跌幅百分比和絕對變化
**通用數值處理**: 
- 價格使用美元符號和適當的小數位數（$.2f格式）
- 百分比顯示到小數點後2位
- 使用 st.metric() 展示關鍵指標，包含 delta 變化值和漲跌方向

### F-006: AI分析功能
**分析目標**: 使用人工智慧對股票技術數據進行專業分析
**AI角色設定**: 專業的技術分析師，精通股票技術分析和歷史數據解讀，提供純教育性和客觀的技術分析
**數據準備**：將FinMind API獲取的原始價格數據，經過移動平均線計算處理後，組合成完整的技術分析數據集
**完整AI提示語結構**:
```
## 系統角色 (System Message)
你是一位專業的技術分析師，專精於股票技術分析和歷史數據解讀。你的職責包括：

1. 客觀描述股票價格的歷史走勢和技術指標狀態
2. 解讀歷史市場數據和交易量變化模式
3. 識別技術面的歷史支撐阻力位
4. 提供純教育性的技術分析知識

重要原則：
- 僅提供歷史數據分析和技術指標解讀，絕不提供任何投資建議或預測
- 保持完全客觀中立的分析態度
- 使用專業術語但保持易懂
- 所有分析僅供教育和研究目的
- 強調技術分析的局限性和不確定性
- 使用繁體中文回答

嚴格的表達方式要求：
- 使用「歷史數據顯示」、「技術指標反映」、「過去走勢呈現」等客觀描述
- 避免「可能性」、「預期」、「建議」、「關注」等暗示性用詞
- 禁用「如果...則...」的假設句型，改用「歷史上當...時，曾出現...現象」
- 不提供具體價位的操作參考點，僅描述技術位階的歷史表現
- 強調「歷史表現不代表未來結果」
- 避免任何可能被解讀為操作指引的表達

免責聲明：所提供的分析內容純粹基於歷史數據的技術解讀，僅供教育和研究參考，不構成任何投資建議或未來走勢預測。歷史表現不代表未來結果。

## 用戶提示語 (User Prompt)
請基於以下股票歷史數據進行深度技術分析：

### 基本資訊
- 股票代號：{symbol}
- 分析期間：{first_date} 至 {last_date}
- 期間價格變化：{price_change:.2f}% (從 ${start_price:.2f} 變化到 ${end_price:.2f})

### 完整交易數據
以下是該期間的完整交易數據，包含日期、開盤價、最高價、最低價、收盤價、成交量和移動平均線：
{data_json}

### 分析架構：技術面完整分析

#### 1. 趨勢分析
- 整體趨勢方向（上升、下降、盤整）
- 關鍵支撐位和阻力位識別
- 趨勢強度評估

#### 2. 技術指標分析
- 移動平均線分析（短期與長期MA的關係）
- 價格與移動平均線的相對位置
- 成交量與價格變動的關聯性

#### 3. 價格行為分析
- 重要的價格突破點
- 波動性評估
- 關鍵的轉折點識別

#### 4. 風險評估
- 當前價位的風險等級
- 潛在的支撐和阻力區間
- 市場情緒指標

#### 5. 市場觀察
- 短期技術面觀察（1-2週）
- 中期技術面觀察（1-3個月）
- 關鍵價位觀察點
- 技術面風險因子

### 綜合評估要求
#### 輸出格式要求
- 條理清晰，分段論述
- 提供具體的數據支撐
- 避免過於絕對的預測，強調分析的局限性
- 在適當位置使用表格或重點標記

分析目標：{symbol}
```

**AI提示語模板設計原則**:
- 系統角色要明確技術分析專業背景和客觀分析風格
- 用戶提示語要包含完整的技術分析架構和步驟
- 每個分析階段都要有具體的技術指標要求和解讀標準
- 要求AI輸出結構化格式，便於閱讀理解
- 包含適當的風險提醒和教育性免責聲明

### F-007: 輔助功能
**進度顯示**: 
- 使用 st.spinner("AI 正在分析中...") 顯示AI分析進度
- 使用 st.info() 顯示數據獲取和處理狀態
- 長時間操作要有明確的進度提示
**數據表格展示**: 
- 使用 st.dataframe() 顯示最近10筆交易數據的詳細表格
- 按日期降序排列，最新數據在前
- 包含日期、開盤、最高、最低、收盤、成交量和移動平均線欄位
**狀態管理**: 
- 使用 st.info() 顯示分析進度和數據處理狀態
- 實施適當的載入動畫和等待提示
- 檢查數據量大小並給予適當警告
**通用狀態反饋標準**: 
- st.success() 用於分析完成確認
- st.error() 用於API錯誤、股票代碼錯誤等，提供具體解決建議
- st.warning() 用於數據量過大警告和操作建議
- st.info() 用於分析進度和數據獲取狀態

### F-008: 錯誤處理與用戶體驗
**通用輸入驗證標準**: 
- 檢查股票代碼是否為空
- 驗證起始日期不能晚於結束日期
- 檢查API金鑰是否已輸入
- 提供股票代碼輸入範例和格式說明
**通用錯誤處理標準**: 
- 所有API調用都要有 try-catch 錯誤處理
- FMP API連線問題要有適當的錯誤提示
- 股票代碼不存在時要有清楚的說明
- OpenAI API調用失敗要有友善的錯誤提示和解決建議
**通用用戶指導標準**: 
- 提供股票代碼輸入範例（如AAPL, MSFT, GOOGL）
- 在日期選擇器旁提供操作說明
- 解釋各個技術指標的用途和意義
- 提供API金鑰獲取的指引連結

### F-009: 免責聲明與安全
**免責聲明位置**: 在側邊欄底部 (st.sidebar.markdown)
**通用免責聲明模板**:
```markdown
### 📢 免責聲明
本系統僅供學術研究與教育用途，AI 提供的數據與分析結果僅供參考，**不構成投資建議或財務建議**。
請使用者自行判斷投資決策，並承擔相關風險。本系統作者不對任何投資行為負責，亦不承擔任何損失責任。
```
**通用安全要求**:
- API金鑰使用 type="password" 安全輸入
- 不在程式碼中寫入敏感資訊
- 實施適當的輸入清理和驗證
- 避免資料外洩和隱私洩露

## 🎨 界面設計與體驗標準
### 整體風格要求
- **專業感**: 界面要看起來專業可信，符合金融分析工具標準
- **易用性**: 操作要簡單直觀，適合各種技術水平的用戶使用
- **美觀性**: 配色和排版要美觀舒適，使用Streamlit的現代化設計
- **一致性**: 各部分風格要統一，保持視覺和操作的連貫性

### 操作流程設計標準
1. **進入系統**: 用戶看到清晰的標題和股票分析工具介紹
2. **輸入階段**: 側邊欄提供邏輯性的輸入順序（股票代碼→API金鑰→日期範圍）
3. **執行階段**: 明確的"分析"按鈕和適當的進度回饋
4. **結果展示**: 分層次的結果呈現，從圖表到數據到AI分析
5. **進階操作**: 支援調整日期範圍和重新分析的能力

### 通用視覺化標準
- **圖表工具**: 統一使用 Plotly Graph Objects 繪製K線圖
- **色彩配置**: 遵循金融圖表的標準配色（紅綠K線、不同顏色的移動平均線）
- **互動功能**: 支援縮放、平移、懸停顯示價格詳情
- **響應式設計**: 使用 use_container_width=True 確保圖表適配
- **載入優化**: 大型數據集要有適當的載入提示和警告

### 通用佈局標準
- **側邊欄寬度**: 保持適中，包含所有必要的輸入控制項
- **欄位間距**: 使用 st.columns(3) 展示基本統計資訊
- **垂直間距**: 適當使用分隔線和空間分隔不同功能區塊
- **內容密度**: 避免資訊過於擁擠，保持清晰的視覺層次

## 📊 品質標準
### 功能品質標準
- 所有主要功能都要能穩定運作，包括API調用和數據處理
- 技術指標計算要準確可靠，與專業金融軟體保持一致
- AI分析要有價值且負責任，避免投資建議和誤導性內容
- 用戶操作要流暢無阻礙，響應時間控制在合理範圍

### 界面品質標準
- K線圖要清晰美觀，符合專業技術分析圖表標準
- 文字要清晰易讀，技術術語要有適當說明
- 操作要直觀簡單，符合用戶對金融工具的使用習慣
- 錯誤提示要友善有用，提供可操作的解決方案

### 效能品質標準
- 初始載入時間控制在 3 秒內
- API數據獲取和處理在 10 秒內完成
- AI分析響應時間控制在 30 秒內
- 支援主流瀏覽器，在不同設備上都能正常運行

### 安全品質標準
- API金鑰要安全處理，不在前端暴露
- 用戶輸入要經過適當的驗證和清理
- 避免常見的網路安全漏洞
- 遵循數據隱私和保護的最佳實踐

## AI實作指令
**請根據以上完整規格說明書，生成一個完整可運行的 Streamlit 網頁應用程式。**

### 必要實現要求
1. **完全實現所有功能需求** (F-001 到 F-009)
2. **符合通用界面設計標準** - 專業、易用、美觀、一致
3. **滿足通用品質標準** - 功能、界面、效能、安全
4. **具備金融分析專業水準** - 符合技術分析工具的專業標準

### 技術實現要求
- **框架**: 使用 Streamlit 框架建立網頁界面
- **API整合**: 整合Financial Modeling Prep API，實施完整錯誤處理
- **AI分析**: 使用OpenAI o4-mini模型，按照提示語模板進行技術分析
- **視覺化**: 使用 Plotly Graph Objects 創建專業K線圖和移動平均線
- **程式品質**: 程式碼要清晰易懂，有適當的中文註釋

### 特別注意事項
- 程式必須完整可執行，可直接用 `streamlit run` 運行
- 所有用戶輸入都要有驗證和友善的錯誤處理
- AI 分析內容要客觀專業，避免投資建議和過度承諾
- K線圖要符合專業技術分析的視覺標準
- 免責聲明要清楚顯示，提醒用戶合理使用

### 程式結構要求
**主要函數需求**:
1. `get_stock_data(symbol)` - 從FMP API獲取股票歷史數據
2. `filter_by_date_range(df, start_date, end_date)` - 根據日期範圍過濾數據
3. `get_moving_averages(df)` - 計算移動平均線（MA5, MA10, MA20, MA60）
4. `generate_ai_insights(symbol, stock_data)` - 使用OpenAI進行技術分析

**主程式邏輯**:
1. 設置頁面標題和側邊欄輸入控制項
2. 實施輸入驗證和錯誤處理
3. 獲取和處理股票數據
4. 繪製互動式K線圖和移動平均線
5. 顯示基本統計資訊
6. 執行AI技術分析
7. 顯示歷史數據表格

### 交付物要求
**最終交付物**: 一個完整的 Python 程式檔案，包含：
- 所有必要的 import 語句 (streamlit, requests, pandas, plotly, openai, datetime, json)
- 完整的函數實現，對應上述四個主要函數
- 主程式邏輯，實現完整的用戶界面和功能
- 適當的中文註釋和說明
- 可以直接執行的完整程式碼，無需額外修改
